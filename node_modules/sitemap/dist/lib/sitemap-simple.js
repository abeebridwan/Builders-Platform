"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.simpleSitemapAndIndex = void 0;
const index_1 = require("../index");
const zlib_1 = require("zlib");
const fs_1 = require("fs");
const path_1 = require("path");
const stream_1 = require("stream");
const util_1 = require("util");
const url_1 = require("url");
const pipeline = util_1.promisify(stream_1.pipeline);
exports.simpleSitemapAndIndex = ({ hostname, sitemapHostname = hostname, // if different
/**
 * Pass a line separated list of sitemap items or a stream or an array
 */
sourceData, destinationDir, limit = 50000, }) => {
    const sitemapAndIndexStream = new index_1.SitemapAndIndexStream({
        limit,
        getSitemapStream: (i) => {
            const sitemapStream = new index_1.SitemapStream({
                hostname,
            });
            const path = `./sitemap-${i}.xml`;
            sitemapStream
                .pipe(zlib_1.createGzip()) // compress the output of the sitemap
                .pipe(fs_1.createWriteStream(path_1.resolve(destinationDir, path + '.gz'))); // write it to sitemap-NUMBER.xml
            return [new url_1.URL(path, sitemapHostname).toString(), sitemapStream];
        },
    });
    let src;
    if (typeof sourceData === 'string') {
        src = index_1.lineSeparatedURLsToSitemapOptions(fs_1.createReadStream(sourceData));
    }
    else if (sourceData instanceof stream_1.Readable) {
        src = sourceData;
    }
    else if (Array.isArray(sourceData)) {
        src = stream_1.Readable.from(sourceData);
    }
    else {
        throw new Error("unhandled source type. You've passed in data that is not supported");
    }
    return pipeline(src, sitemapAndIndexStream, zlib_1.createGzip(), fs_1.createWriteStream(path_1.resolve(destinationDir, './sitemap-index.xml.gz')));
};
exports.default = exports.simpleSitemapAndIndex;
